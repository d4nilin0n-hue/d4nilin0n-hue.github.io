<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <title>Spotify</title>
        <link rel="stylesheet" href="style.css">
</head>
<body>
    <img src="./src/img/bg.png" alt="" class="bg">
    <header>
        <img src="./src/img/logo.png" alt="logo">
        <nav class="nav-links">
            <button class="sel navigable" onclick="gotosection('browse')" tabindex="0">Browse</button>
            <button class="navigable" onclick="gotosection('yourmusic')" tabindex="0">Your music</button>
        </nav>
        <div class="right-section">
            <img src="./src/search.svg" alt="search-svg" class="navigable search-icon" tabindex="0">
            <div class="division"></div>
            <img src="" class="pfp navigable" alt="pfp" tabindex="0">
        </div>
    </header>
    <div id="main" style="display:none;">
        <p class="title">WHAT DO YOU WANT TO HEAR TODAY?</p>
        <div class="search-section" style="display: none;">
            <input type="text" id="searchInput" placeholder="Search" />
            <button id="searchBtn">Search</button>
            <p class="playing">Active devices: <span id="deviceName">loading...</span></p>
        </div>
        <div class="container--">
            <div id="popularPlaylists" class="highlighted --section"></div>
            <div class="division"></div>
            <div id="topGenres" class="--section"></div>
        </div>
        <ul id="results"></ul>
    </div>
    <div id="yourmusic">
        <p class="title">SONGS</p>
        <div class="container--">
            <div id="myFavouriteSongsSection" class="--section"></div>
        </div>
    </div>
    <div id="login">
        <img src="./src/img/welcome-bg.jpg" alt="" class="bg">
        <img src="./src/img/spotify-large.png" alt="" class="logo">
        <button id="loginBtn" onclick="document.getElementById('login').style.display = 'none'; document.getElementById('login-step-two').style.display = 'block';">Connect with Spotify</button>
    </div>
    <div id="login-step-two" style="display: none;">
        <h1>Scan the QR Code shown with your smartphone.</h1>
        <br><br>
        <img src="./src/img/qrcode.png" alt="">
        <div class="button-container">
            <button onclick="document.getElementById('login').style.display = 'block'; document.getElementById('login-step-two').style.display = 'none';">
                Back
            </button>
            <button onclick="document.getElementById('login-step-three').style.display = 'block'; document.getElementById('login-step-two').style.display = 'none';">
                Done
            </button>
        </div>
    </div>
    <div id="login-step-three" style="display: none;">
        <h1>Enter the token shown on your device</h1>
        <input type="text" id="codeInput">
        <div class="button-container">
            <button onclick="document.getElementById('login-step-three').style.display = 'none'; document.getElementById('login-step-two').style.display = 'block';">
                Back
            </button>
            <button id="submitCodeBtn" onclick="const token = document.getElementById('codeInput').value.trim();if (!token) {    document.querySelector('.warning-text').textContent = 'Pega un token válido primero';    document.getElementById('ps3Warning').style.display = 'flex';    return;}const xhr = new XMLHttpRequest();xhr.open('GET', spotifyme, true);xhr.setRequestHeader('Authorization', 'Bearer ' + token);xhr.onload = function() {if (xhr.status === 200) {const user = JSON.parse(xhr.responseText);accessToken = token;localStorage.setItem('spotify_token', token);document.getElementById('login-step-three').style.display = 'none';document.getElementById('main').style.display = 'block';getActiveDevice();populateUI(user);loadPopularPlaylists();loadTopGenres();loadLikedSongs();setTimeout(initOrRefreshKeyboardNavigation, 1000);document.querySelector('.warning-text').textContent = '¡Conectado como ' + (user.display_name || user.id) + '!';document.getElementById('ps3Warning').style.display = 'flex';} else {document.querySelector('.warning-text').textContent = 'Token inválido o expirado. Intenta de nuevo.';document.getElementById('ps3Warning').style.display = 'flex';}};xhr.onerror = function() {document.querySelector('.warning-text').textContent = 'Error de red. Revisa tu conexión.';document.getElementById('ps3Warning').style.display = 'flex';};xhr.send();">
                Submit
            </button>
    </div>
    <div id="ps3Warning" class="warning-modal" style="display: none;">
        <div class="warning-content">
            <p class="warning-text"></p>
            <hr class="warning-line" style="width: 80vw;">
            <button class="ok-btn" onclick="closeWarning()">
            <span class="x-icon">✖</span> OK
            </button>
        </div>
    </div>
    <script src="./src/js/script.js" async defer></script>
</body>
</html>
